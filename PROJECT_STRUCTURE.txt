PROJECT STRUCTURE - Business Management Application
==================

Application Overview:
This is a comprehensive Node.js Single Page Application for business management, supporting multi-firm operations with modules for user management, employee records, wages, inventory, and accounting. Database: MongoDB with Mongoose ODM.

nodejs-spa-auth/
â”‚
â”œâ”€â”€ ğŸ“„ package.json              # Node.js dependencies and scripts
â”œâ”€â”€ ğŸ“„ package-lock.json         # npm dependencies lock file
â”œâ”€â”€ ğŸ“„ .env                      # Environment variables (actual)
â”œâ”€â”€ ğŸ“„ .env.example              # Environment variables template
â”œâ”€â”€ ğŸ“„ vercel.json               # Vercel deployment configuration
â”œâ”€â”€ ğŸ“„ PROJECT_STRUCTURE.txt     # This file - project documentation
â”œâ”€â”€ ğŸ“„ .gitignore                # Git ignore file
â”œâ”€â”€ ğŸ”¨ setup.sh                  # Linux/Mac setup script
â”œâ”€â”€ ğŸ”¨ setup.bat                 # Windows setup script
â”‚
â”œâ”€â”€ ğŸ“ .git/                     # Git repository
â”œâ”€â”€ ğŸ“ .vercel/                  # Vercel configuration
â”œâ”€â”€ ğŸ“ .vscode/                  # VS Code settings
â”œâ”€â”€ ğŸ“ node_modules/             # npm dependencies
â”‚
â”œâ”€â”€ ğŸ“ docs/                     # Comprehensive documentation (29 files)
â”‚
â”œâ”€â”€ ğŸ“ prisma/                   # Prisma ORM configuration
â”‚   â””â”€â”€ ğŸ“„ schema.prisma         # Database schema definition (MongoDB)
â”‚
â”œâ”€â”€ ğŸ“ server/                   # Backend (Express.js + MongoDB + Mongoose ODM)
â”‚   â”œâ”€â”€ ğŸ“„ server.js            # Main server entry point
â”‚   â”œâ”€â”€ ğŸ“„ server1.js           # Alternative server configuration
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ controllers/         # Business logic controllers (8 files + 3 subdirectories)
â”‚   â”‚   â”œâ”€â”€ authController.js   # Authentication (login, logout, refresh)
â”‚   â”‚   â”œâ”€â”€ firmManagementController.js # Firm CRUD operations
â”‚   â”‚   â”œâ”€â”€ masterRoll.controller.js # Employee records management
â”‚   â”‚   â”œâ”€â”€ wages.controller.js # Salary and wage processing
â”‚   â”‚   â”œâ”€â”€ settingsController.js # System settings
â”‚   â”‚   â”œâ”€â”€ systemConfigController.js # System configuration
â”‚   â”‚   â”œâ”€â”€ ğŸ“ inventory/       # Inventory controllers (category-wise)
â”‚   â”‚   â”‚   â”œâ”€â”€ pdfMakeController.js # PDF generation for inventory
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ cnt/         # Inventory count controllers
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ inventory.js
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ dln/         # Inventory delivery note controllers
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ inventory.js
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ dnt/         # Inventory debit note controllers
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ inventory.js
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ prs/         # Inventory purchase controllers
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ inventory.js
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ sls/         # Inventory sales controllers
â”‚   â”‚   â”‚       â””â”€â”€ inventory.js
â”‚   â”‚   â”œâ”€â”€ ğŸ“ ledger/          # Accounting controllers (5 files)
â”‚   â”‚   â”‚   â”œâ”€â”€ journalEntryController.js # Journal entries
â”‚   â”‚   â”‚   â”œâ”€â”€ ledgerController.js # Ledger operations
â”‚   â”‚   â”‚   â”œâ”€â”€ voucherController.js # Voucher management
â”‚   â”‚   â”‚   â”œâ”€â”€ pdfMakeController.js # PDF for ledger
â”‚   â”‚   â”‚   â””â”€â”€ ledger.csv      # Ledger data export
â”‚   â”‚   â””â”€â”€ ğŸ“ mongo/           # MongoDB controllers (8 files + 2 subdirectories)
â”‚   â”‚       â”œâ”€â”€ authController.js # MongoDB auth controller
â”‚   â”‚       â”œâ”€â”€ firmManagementController.js # MongoDB firm management
â”‚   â”‚       â”œâ”€â”€ masterRoll.controller.js # MongoDB master roll
â”‚   â”‚       â”œâ”€â”€ pageController.js # MongoDB page controller
â”‚   â”‚       â”œâ”€â”€ settingsController.js # MongoDB settings
â”‚   â”‚       â”œâ”€â”€ systemConfigController.js # MongoDB system config
â”‚   â”‚       â”œâ”€â”€ wages.controller.js # MongoDB wages controller
â”‚   â”‚       â”œâ”€â”€ ğŸ“ inventory/       # MongoDB inventory controllers
â”‚   â”‚       â”‚   â””â”€â”€ ğŸ“ sls/         # MongoDB sales controllers
â”‚   â”‚       â”‚       â””â”€â”€ inventory.js # Complete inventory management with Excel export
â”‚   â”‚       â””â”€â”€ ğŸ“ ledger/          # MongoDB ledger controllers (4 files)
â”‚   â”‚           â”œâ”€â”€ journalEntryController.js # MongoDB journal entries
â”‚   â”‚           â”œâ”€â”€ ledgerController.js # MongoDB ledger operations
â”‚   â”‚           â”œâ”€â”€ pdfMakeController.js # MongoDB PDF for ledger
â”‚   â”‚           â””â”€â”€ voucherController.js # MongoDB voucher management
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ models/              # Mongoose models (17 files)
â”‚   â”‚   â”œâ”€â”€ Bill.model.js       # Bill/invoice model
â”‚   â”‚   â”œâ”€â”€ BillSequence.model.js # Bill sequence model
â”‚   â”‚   â”œâ”€â”€ Firm.model.js       # Firm model
â”‚   â”‚   â”œâ”€â”€ FirmSettings.model.js # Firm settings model
â”‚   â”‚   â”œâ”€â”€ Ledger.model.js     # Ledger entries model
â”‚   â”‚   â”œâ”€â”€ MasterRoll.model.js # Employee records model
â”‚   â”‚   â”œâ”€â”€ Party.model.js      # Customer/supplier model
â”‚   â”‚   â”œâ”€â”€ RefreshToken.model.js # Refresh token model
â”‚   â”‚   â”œâ”€â”€ Settings.model.js   # Global settings model
â”‚   â”‚   â”œâ”€â”€ Stock.model.js      # Inventory stock model with batch support
â”‚   â”‚   â”œâ”€â”€ StockReg.model.js   # Stock movement model
â”‚   â”‚   â”œâ”€â”€ User.model.js       # User accounts model
â”‚   â”‚   â”œâ”€â”€ UserMasterRoll.model.js # User-employee relation model
â”‚   â”‚   â”œâ”€â”€ UserWage.model.js   # User-wage relation model
â”‚   â”‚   â”œâ”€â”€ VoucherSequence.model.js # Voucher sequence model
â”‚   â”‚   â”œâ”€â”€ Wage.model.js       # Wage records model
â”‚   â”‚   â””â”€â”€ index.js            # Models index file
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ routes/              # API route definitions (10 files + 1 subdirectory)
â”‚   â”‚   â”œâ”€â”€ admin.js            # Admin routes
â”‚   â”‚   â”œâ”€â”€ api.js              # General API routes
â”‚   â”‚   â”œâ”€â”€ auth.js             # Authentication routes
â”‚   â”‚   â”œâ”€â”€ authRoutes.js       # Auth routes (legacy)
â”‚   â”‚   â”œâ”€â”€ ledger.routes.js    # Ledger routes
â”‚   â”‚   â”œâ”€â”€ masterRoll.routes.js # Master roll routes
â”‚   â”‚   â”œâ”€â”€ pageRoutes.js       # Page routes
â”‚   â”‚   â”œâ”€â”€ settings.routes.js  # Settings routes
â”‚   â”‚   â”œâ”€â”€ wages.routes.js     # Wages routes
â”‚   â”‚   â””â”€â”€ ğŸ“ inventory/       # Inventory routes
â”‚   â”‚       â””â”€â”€ sls.js          # Sales routes
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ middleware/          # Express middleware (3 files + mongo subdirectory)
â”‚   â”‚   â”œâ”€â”€ auth.js             # Auth middleware
â”‚   â”‚   â”œâ”€â”€ authMiddleware.js   # JWT validation & auto-refresh
â”‚   â”‚   â”œâ”€â”€ securityMiddleware.js # CSP/XSS headers
â”‚   â”‚   â””â”€â”€ ğŸ“ mongo/           # MongoDB middleware (2 files)
â”‚   â”‚       â”œâ”€â”€ authMiddleware.js # MongoDB-compatible auth middleware
â”‚   â”‚       â””â”€â”€ securityMiddleware.js # MongoDB-compatible security middleware
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ utils/               # Server utilities (12 files + 2 subdirectories)
â”‚       â”œâ”€â”€ billNumberGenerator.js # Bill number generation
â”‚       â”œâ”€â”€ dateFormatter.js    # Date formatting utilities
â”‚       â”œâ”€â”€ db.js               # Database connection and schema
â”‚       â”œâ”€â”€ generated/          # Generated files directory (empty)
â”‚       â”œâ”€â”€ gstCalculator.js    # GST calculations
â”‚       â”œâ”€â”€ ledgerHelper.js     # Ledger operations helper
â”‚       â”œâ”€â”€ pdfGenerator.js     # PDF generation for reports
â”‚       â”œâ”€â”€ prisma.js           # Prisma client singleton instance
â”‚       â”œâ”€â”€ seed-prisma.js      # Prisma database seeding script
â”‚       â”œâ”€â”€ seed-super-admin.js # Super admin seeding
â”‚       â”œâ”€â”€ seed.js             # Database seeding
â”‚       â”œâ”€â”€ tokenUtils.js       # JWT generation & verification
â”‚       â”œâ”€â”€ users.json          # Demo users data
â”‚       â””â”€â”€ ğŸ“ mongo/           # MongoDB utilities (8 files)
â”‚           â”œâ”€â”€ mongoose.config.js # MongoDB connection configuration
â”‚           â”œâ”€â”€ dateFormatter.js  # MongoDB-compatible date formatting
â”‚           â”œâ”€â”€ gstCalculator.js  # MongoDB-compatible GST calculations
â”‚           â”œâ”€â”€ ledgerHelper.js   # MongoDB-compatible ledger helper
â”‚           â”œâ”€â”€ pdfGenerator.js   # MongoDB-compatible PDF generation
â”‚           â”œâ”€â”€ seed-super-admin.js # MongoDB super admin seeding
â”‚           â”œâ”€â”€ seed.js           # MongoDB database seeding
â”‚           â””â”€â”€ tokenUtils.js     # MongoDB-compatible token utilities
â”‚
â”œâ”€â”€ ğŸ“ client/                  # Frontend (Vanilla JS SPA with Navigo.js)
â”‚   â”œâ”€â”€ ğŸ“„ index.html           # Main HTML entry point
â”‚   â”œâ”€â”€ ğŸ“„ app.js               # Router configuration (lazy loading)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ public/              # Static assets (3 subdirectories)
â”‚   â”‚   â”œâ”€â”€ ğŸ“ cdns/            # CDN libraries
â”‚   â”‚   â”œâ”€â”€ ğŸ“ css/             # Stylesheets
â”‚   â”‚   â””â”€â”€ ğŸ“ fonts/           # Font files
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ pages/               # Page components (16 files + 1 subdirectory)
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ home.js             # Public home page
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ about.js            # Public about page
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ login.js            # Login page
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ dashboard.js        # Main dashboard
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ profile.js          # User profile
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ authPage.js         # Authentication page
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ master-roll.js      # Employee records page
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ WagesDashboard.js   # Wages management dashboard
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ sales.js            # Sales page
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ stocks.js           # Stocks page
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ inventory-dashboard.js # Inventory dashboard
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ inventory-categories.js # Inventory categories
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ inventory-suppliers.js # Suppliers management
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ inventory-reports.js # Inventory reports
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ stock-movement.js    # Stock movement tracking
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ accounts-dashboard.js # Accounts dashboard
â”‚   â”‚   â””â”€â”€ ğŸ“ ledger/          # Ledger pages (7 files)
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ journal-entries.js
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ vouchers.js
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ trial-balance.js
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ general-ledger.js
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ account-details.js
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ new-journal-entry.js
â”‚   â”‚       â””â”€â”€ ğŸ“„ new-voucher.js
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ components/          # Reusable UI components (4 files + 2 subdirectories)
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ layout.js           # Page layout
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ navbar.js           # Navigation bar
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ sidebar.js          # Sidebar navigation
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ voucher-modal.js    # Voucher modal
â”‚   â”‚   â”œâ”€â”€ ğŸ“ inventory/       # Inventory components (19 files)
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ sls/         # Sales components (16 files)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ batchModal.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ cartManager.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ chargesModal.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ historyModal.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ index.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ invoiceExport.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ layoutRenderer.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ otherChargesManager.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ partyCreate.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ partyManager.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ partyModal.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ stateManager.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ stockCrud.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ stockModal.js
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ toast.js
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ utils.js
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ stocks/      # Stock components (3 files)
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ index.js
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ stockApi.js
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ stockRenderer.js # Enhanced batch management with UOM/GST support
â”‚   â”‚   â””â”€â”€ ğŸ“ wages/           # Wages components (3 files)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ utils/               # Client utilities (2 files)
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ api.js              # HTTP client wrapper
â”‚   â”‚   â””â”€â”€ ğŸ“„ auth.js             # Authentication manager
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ middleware/          # Client-side middleware (1 file)
â”‚       â””â”€â”€ ğŸ“„ authMiddleware.js   # Route guards
â”‚
â”œâ”€â”€ ğŸ“ api/                     # Serverless API for Vercel (1 file)
â”‚   â””â”€â”€ index.js                # Vercel serverless entry point
â”‚
â”œâ”€â”€ ğŸ“ src/                     # Source files (1 item)
â”‚   â””â”€â”€ input.css               # Tailwind CSS input
â”‚
â”œâ”€â”€ ğŸ“ public/                  # Public static files (empty)
â”‚
â””â”€â”€ ğŸ“ TST/                      # Test directory (empty)


DATABASE SCHEMA OVERVIEW
========================

Tables:
- firms: Multi-firm support with business details
- users: User accounts with roles (user, manager, admin, super_admin)
- refresh_tokens: JWT refresh token storage
- master_rolls: Employee records with personal and work details
- wages: Salary and wage processing records
- user_master_rolls: User-employee assignment (many-to-many)
- user_wages: User-wage assignment (many-to-many)
- stocks: Inventory items with batch support (enhanced with uom/grate fields)
- parties: Customers and suppliers
- bills: Sales/purchase invoices
- stock_reg: Stock movement transactions
- ledger: General ledger entries
- bill_sequences: Bill number generation sequences
- voucher_sequences: Voucher number generation sequences
- settings: Global application settings
- firm_settings: Firm-specific settings


KEY FEATURES
============

âœ… Multi-Firm Business Management System
âœ… Dual Token JWT Authentication (Access: 15min, Refresh: 30 days)
âœ… Automatic Token Refresh (every 10 minutes)
âœ… HTTP-only Cookies with SameSite protection
âœ… Content Security Policy (CSP) headers
âœ… XSS Protection
âœ… MongoDB with Mongoose ODM
âœ… Enhanced Batch Management with UOM and GST Rate Support
âœ… PDF Report Generation
âœ… Excel Export Functionality (Stock Movements)
âœ… GST Calculations
âœ… Employee Master Rolls & Wage Management
âœ… Inventory Management (Stocks, Parties, Bills, Movements)
âœ… Accounting Ledger (Journal Entries, Vouchers, Trial Balance)
âœ… Responsive Vanilla JS SPA with Navigo.js routing
âœ… Lazy-loaded pages for performance
âœ… Protected and public routes
âœ… Clean ES6 module architecture
âœ… Vercel Serverless Deployment Ready


QUICK START
===========

1. Run setup:
   Linux/Mac: ./setup.sh
   Windows:   setup.bat

2. Start server:
   npm start

3. Open browser:
   http://localhost:3000

4. Login with demo credentials:
   admin/admin123, user/user123, or demo/demo123


RECENT ENHANCEMENTS
==================

ğŸ”§ Stock Management Enhancements:
- Fixed UOM and GST rate field persistence in batch management
- Added comprehensive migration logic for existing batch data
- Enhanced database schema with proper batch field support
- Improved client-side field validation and updates
- Added Excel export functionality for stock movements

ğŸ”§ Database Schema Updates:
- Added VoucherSequence model for auto-increment voucher IDs
- Enhanced Stock model with proper batch schema (uom, grate fields)
- Improved data consistency between batch and root-level fields

ğŸ”§ API Enhancements:
- MongoDB-specific controllers for better performance
- Enhanced error handling and validation
- Improved data migration and backward compatibility
